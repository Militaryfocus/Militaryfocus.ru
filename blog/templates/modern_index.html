{% extends "base.html" %}

{% block title %}Главная - {{ super() }}{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modern-style.css') }}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="hero-content text-center">
            <h1 class="hero-title">Добро пожаловать в Military Focus</h1>
            <p class="hero-subtitle">Современный блог о технологиях, науке и инновациях</p>
            <div class="hero-buttons">
                <a href="#posts" class="btn-modern btn-modern-primary">
                    <i class="fas fa-arrow-down"></i>
                    Читать статьи
                </a>
                <a href="{{ url_for('blog.create_post') }}" class="btn-modern btn-modern-outline">
                    <i class="fas fa-pen"></i>
                    Написать пост
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Статистика -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-3 col-6 mb-4 animate-on-scroll">
                <div class="stat-card">
                    <h2 class="gradient-text display-4 fw-bold">{{ stats.posts_count }}</h2>
                    <p class="text-muted">Статей</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4 animate-on-scroll" style="animation-delay: 0.1s">
                <div class="stat-card">
                    <h2 class="gradient-text display-4 fw-bold">{{ stats.authors_count }}</h2>
                    <p class="text-muted">Авторов</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4 animate-on-scroll" style="animation-delay: 0.2s">
                <div class="stat-card">
                    <h2 class="gradient-text display-4 fw-bold">{{ stats.views_count }}</h2>
                    <p class="text-muted">Просмотров</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4 animate-on-scroll" style="animation-delay: 0.3s">
                <div class="stat-card">
                    <h2 class="gradient-text display-4 fw-bold">{{ stats.comments_count }}</h2>
                    <p class="text-muted">Комментариев</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Популярные категории -->
<section class="py-5">
    <div class="container">
        <h2 class="text-center mb-5 animate-on-scroll">Популярные категории</h2>
        <div class="row">
            {% for category in popular_categories %}
            <div class="col-md-4 col-sm-6 mb-4 animate-on-scroll" style="animation-delay: {{ loop.index0 * 0.1 }}s">
                <a href="{{ url_for('blog.category_posts', slug=category.slug) }}" class="text-decoration-none">
                    <div class="category-card glass p-4 text-center h-100">
                        <div class="category-icon mb-3">
                            <i class="fas fa-{{ category.icon|default('folder') }} fa-3x" style="color: {{ category.color }}"></i>
                        </div>
                        <h4>{{ category.name }}</h4>
                        <p class="text-muted">{{ category.posts.count() }} статей</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Последние посты -->
<section class="py-5 bg-light" id="posts">
    <div class="container">
        <h2 class="text-center mb-5 animate-on-scroll">Последние статьи</h2>
        <div class="row posts-container">
            {% for post in recent_posts %}
            <div class="col-md-6 col-lg-4 mb-4 animate-on-scroll" style="animation-delay: {{ loop.index0 * 0.1 }}s">
                <article class="modern-card" onclick="window.location.href='{{ url_for('blog.post_detail', slug=post.slug) }}'">
                    {% if post.image_url %}
                    <img data-src="{{ post.image_url }}" alt="{{ post.title }}" class="modern-card-image" loading="lazy">
                    {% else %}
                    <div class="modern-card-image" style="background: var(--gradient-primary)"></div>
                    {% endif %}
                    <div class="modern-card-body">
                        {% if post.category %}
                        <span class="modern-card-category" style="background: {{ post.category.color }}">
                            {{ post.category.name }}
                        </span>
                        {% endif %}
                        <h3 class="modern-card-title">{{ post.title }}</h3>
                        <p class="modern-card-excerpt">{{ post.excerpt or post.content[:150] }}...</p>
                        <div class="modern-card-meta">
                            <div class="modern-card-author">
                                <img src="{{ post.author.avatar or '/static/images/default-avatar.png' }}" 
                                     alt="{{ post.author.username }}" class="author-avatar">
                                <span>{{ post.author.username }}</span>
                            </div>
                            <span>
                                <i class="far fa-calendar"></i>
                                {{ post.created_at.strftime('%d.%m.%Y') }}
                            </span>
                        </div>
                    </div>
                </article>
            </div>
            {% endfor %}
        </div>
        
        {% if has_more_posts %}
        <div class="infinite-scroll-loader" style="display: none;">
            <div class="spinner"></div>
        </div>
        {% endif %}
        
        <div class="text-center mt-4">
            <a href="{{ url_for('blog.post_list') }}" class="btn-modern btn-modern-primary">
                Все статьи
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </div>
</section>

<!-- Популярные авторы -->
<section class="py-5">
    <div class="container">
        <h2 class="text-center mb-5 animate-on-scroll">Популярные авторы</h2>
        <div class="row">
            {% for author in popular_authors %}
            <div class="col-md-3 col-sm-6 mb-4 animate-on-scroll" style="animation-delay: {{ loop.index0 * 0.1 }}s">
                <div class="author-card text-center">
                    <img src="{{ author.avatar or '/static/images/default-avatar.png' }}" 
                         alt="{{ author.username }}" class="author-avatar-large mb-3">
                    <h5>{{ author.username }}</h5>
                    <p class="text-muted small">{{ author.posts.count() }} статей</p>
                    <a href="{{ url_for('blog.author_posts', username=author.username) }}" 
                       class="btn btn-sm btn-outline-primary">
                        Читать статьи
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Call to Action -->
<section class="py-5 parallax-section" style="background-image: url('/static/images/cta-bg.jpg');">
    <div class="parallax-overlay"></div>
    <div class="parallax-content">
        <div class="container text-center">
            <h2 class="display-4 mb-4">Готовы поделиться своими идеями?</h2>
            <p class="lead mb-4">Присоединяйтесь к нашему сообществу авторов</p>
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('blog.create_post') }}" class="btn-modern btn-modern-primary btn-lg">
                <i class="fas fa-pen"></i>
                Написать статью
            </a>
            {% else %}
            <a href="{{ url_for('auth.register') }}" class="btn-modern btn-modern-primary btn-lg">
                <i class="fas fa-user-plus"></i>
                Зарегистрироваться
            </a>
            {% endif %}
        </div>
    </div>
</section>

<!-- Floating Action Button -->
<div class="fab" style="transform: scale(0);">
    <i class="fas fa-arrow-up"></i>
</div>

<!-- Share Modal -->
<div class="modal-modern" id="shareModal">
    <div class="modal-modern-content">
        <div class="modal-modern-header">
            <h4>Поделиться</h4>
            <button class="btn-close modal-close">&times;</button>
        </div>
        <div class="modal-modern-body">
            <div class="share-buttons">
                <button class="btn-share" onclick="modernUI.share('Military Focus Blog', window.location.href)">
                    <i class="fas fa-share-alt"></i> Поделиться
                </button>
                <button class="btn-share" onclick="modernUI.copyToClipboard(window.location.href)">
                    <i class="fas fa-link"></i> Копировать ссылку
                </button>
            </div>
        </div>
    </div>
</div>

<style>
/* Дополнительные стили для главной страницы */
.stat-card {
    padding: 2rem;
    background: white;
    border-radius: 16px;
    box-shadow: var(--shadow-md);
    transition: transform var(--transition-base);
}

.stat-card:hover {
    transform: translateY(-4px);
}

.category-card {
    transition: all var(--transition-base);
    height: 100%;
}

.category-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.category-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(0,0,0,0.05);
}

.author-card {
    padding: 2rem;
    background: white;
    border-radius: 16px;
    box-shadow: var(--shadow-md);
    transition: all var(--transition-base);
}

.author-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.author-avatar-large {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #f0f0f0;
}

.animate-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.6s ease-out;
}

.animate-on-scroll.animated {
    opacity: 1;
    transform: translateY(0);
}

.share-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.btn-share {
    flex: 1;
    padding: 1rem;
    border: none;
    background: #f0f0f0;
    border-radius: 8px;
    cursor: pointer;
    transition: all var(--transition-base);
}

.btn-share:hover {
    background: #e0e0e0;
    transform: translateY(-2px);
}
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/modern-ui.js') }}"></script>
<script>
// Инициализация статистики
document.addEventListener('DOMContentLoaded', function() {
    // Анимация чисел
    const animateValue = (el, start, end, duration) => {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            el.textContent = Math.floor(progress * (end - start) + start);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    };

    // Запускаем анимацию при появлении в viewport
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const el = entry.target;
                const finalValue = parseInt(el.textContent);
                animateValue(el, 0, finalValue, 2000);
                observer.unobserve(el);
            }
        });
    });

    document.querySelectorAll('.stat-card h2').forEach(el => {
        observer.observe(el);
    });
});
</script>
{% endblock %}